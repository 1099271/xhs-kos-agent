# 系统设计

## 1. 总体架构

本项目采用基于 LangGraph 的 Agent 驱动架构，构建智能营销 Agent 系统。该系统主要服务于小红书平台，通过自动化内容采集、分析、互动等方式，提升营销效率和效果，赋能 KOS (Key Opinion Sales) 在社交媒体平台的深度运营。

核心业务流程由 LangGraph Agents/Workflows 编排和执行，这些 Agents 调用一系列模块化的业务服务和工具完成具体任务。系统使用 MySQL 作为持久化存储，可通过 FastAPI 提供 API 接口或通过 CLI 执行任务。

## 2. 核心组件及技术栈

| 组件                                                        | 技术选型                                      | 职责与交互                                                                                                                                                        |
| ----------------------------------------------------------- | --------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Agents/Workflows** <br> `apps/agents/`, `apps/workflows/` | LangGraph, LangChain                          | **职责**: 定义和执行核心业务流程，系统的决策大脑。<br>**交互**: 调用 Tools 执行具体操作，管理状态。<br>**选型理由**: 支持复杂控制流、条件分支、循环，可观测性好。 |
| **业务服务层** <br> `apps/services/`                        | Python                                        | **职责**: 封装独立业务逻辑，如数据采集、内容分析、文案生成等。<br>**交互**: 被 Tools 封装后供 Agents 调用，或被 API 层直接调用。                                  |
| **工具层** <br> `apps/tools/`                               | LangChain Tools                               | **职责**: 为 Agents 提供标准化接口调用业务服务。<br>**交互**: 由 Agents 在工作流节点中调用。                                                                      |
| **API 层** <br> `apps/api/`                                 | FastAPI, Pydantic                             | **职责**: (可选) 提供 HTTP API 接口。<br>**交互**: 接收外部请求，调用 Services。<br>**选型理由**: 性能高，支持异步，类型提示友好，文档自动生成。                  |
| **数据模型** <br> `apps/schemas/`                           | Pydantic                                      | **职责**: 定义数据校验、API 请求/响应模型、内部数据结构。<br>**交互**: 被 API 层、服务层广泛使用。 <br>**选型理由**: 类型安全，与 FastAPI 良好集成。              |
| **数据持久化** <br> `infra/db/`                             | MySQL, SQLAlchemy                             | **职责**: 存储业务数据、状态等。<br>**交互**: 被 Services 层通过 ORM 操作。<br>**选型理由**: 成熟稳定，生态丰富，满足关系型数据需求。                             |
| **MCP 集成** <br> `apps/mcp_tools/`                         | MCP (Model Context Protocol)                  | **职责**: 实现与 MCP 生态集成。<br>**交互**: 可作为 Server 暴露能力或作为 Client 调用外部服务。<br>**选型理由**: 促进组件解耦和标准化交互。                       |
| **命令行界面** <br> `cli/`                                  | Click/Typer                                   | **职责**: 提供 CLI 工具。<br>**交互**: 调用 Services 或触发 Agents。<br>**选型理由**: 易用，快速构建结构清晰的命令行工具。                                        |
| **LLM 集成**                                                | langchain-openai, <br> langchain-anthropic 等 | **职责**: 与具体 LLM 交互。<br>**选型理由**: 封装了认证和请求构建细节。                                                                                           |
| **基础环境**                                                | Python, uv, .venv                             | **选型理由**: Python 生态丰富，uv 提供快速包管理，虚拟环境确保依赖隔离。                                                                                          |

## 3. 业务流程示例：高价值用户互动

1. **触发**: 通过 CLI 或 API 启动"高价值用户互动 Agent"。
2. **数据检索与筛选**: Agent 调用 `UserTargetingService` (通过相应 Tool)，筛选高价值用户及相关数据。
3. **用户行为分析**: Agent 调用分析服务或 LLM 直接分析用户偏好。
4. **个性化文案生成**: 基于分析结果，调用内容生成服务生成评论或私信文案。
5. **审核与执行**: 文案可存入数据库待人工审核，或配置为自动执行互动。
6. **结果记录与反馈收集**: 记录互动结果及用户反馈，用于评估和优化。

## 4. 核心业务目标

- **产品知识库构建与管理**: 自动整理产品信息，形成知识库。
- **目标用户与内容洞察**: 精准采集分析小红书内容，生成报告。
- **智能化用户互动与转化**: 筛选用户，生成个性化互动文案。
- **反馈闭环与持续优化**: 收集反馈，优化策略和系统行为。

_有关详细的项目文件夹结构说明，请参考 `docs/folder_structure.md`。_
